# üçî FoodV - Backend API

> **Sistema de Delivery para la Universidad C√©sar Vallejo**

Backend completo desarrollado en Spring Boot para la aplicaci√≥n m√≥vil de delivery FoodV, dise√±ado espec√≠ficamente para estudiantes y personal de la Universidad C√©sar Vallejo. Permite realizar pedidos al minimarket "Listo", la dulcer√≠a "Fresco" y a emprendedores universitarios.

## üìã Tabla de Contenidos

- [Caracter√≠sticas](#-caracter√≠sticas)
- [Tecnolog√≠as](#-tecnolog√≠as)
- [Arquitectura](#-arquitectura)
- [M√≥dulos Implementados](#-m√≥dulos-implementados)
- [Sistema de Autenticaci√≥n UCV](#-sistema-de-autenticaci√≥n-ucv)
- [Instalaci√≥n y Configuraci√≥n](#-instalaci√≥n-y-configuraci√≥n)
- [API Endpoints](#-api-endpoints)
- [Datos de Prueba](#-datos-de-prueba)
- [Pruebas con Postman](#-pruebas-con-postman)
- [Estructura del Proyecto](#-estructura-del-proyecto)
- [Configuraci√≥n de Producci√≥n](#-configuraci√≥n-de-producci√≥n)
- [Soluci√≥n de Problemas](#-soluci√≥n-de-problemas)

## üöÄ Caracter√≠sticas

- **üîê Autenticaci√≥n JWT**: Sistema seguro de autenticaci√≥n con tokens JWT
- **üéì Autenticaci√≥n UCV**: Sistema espec√≠fico para estudiantes UCV con validaci√≥n de username y OTP
- **üìß Env√≠o de Emails**: Sistema de verificaci√≥n por email con c√≥digos OTP
- **üõí Carrito de Compras**: Gesti√≥n completa del carrito con c√°lculos autom√°ticos
- **üì¶ Gesti√≥n de Pedidos**: Sistema completo de pedidos con estados
- **üè™ M√∫ltiples Tiendas**: Soporte para minimarket, dulcer√≠a y emprendedores
- **üîç B√∫squeda Avanzada**: B√∫squeda de productos por nombre y categor√≠a
- **üì± API REST**: Endpoints RESTful completamente documentados
- **üõ°Ô∏è Seguridad**: Configuraci√≥n de seguridad robusta con Spring Security
- **üìä Validaci√≥n**: Validaci√≥n completa de datos con Hibernate Validator
- **üå± Datos de Prueba**: Seeds autom√°ticos para desarrollo y testing

## üõ†Ô∏è Tecnolog√≠as

| Tecnolog√≠a | Versi√≥n | Descripci√≥n |
|------------|---------|-------------|
| **Java** | 21+ | Lenguaje de programaci√≥n |
| **Spring Boot** | 3.5.6 | Framework principal |
| **Spring Security** | 6.x | Autenticaci√≥n y autorizaci√≥n |
| **Spring Data JPA** | 3.x | ORM y persistencia |
| **Spring Mail** | 3.x | Env√≠o de emails |
| **PostgreSQL** | 12+ | Base de datos |
| **Maven** | 3.6+ | Gesti√≥n de dependencias |
| **JWT** | 0.11.5 | Tokens de autenticaci√≥n |
| **Lombok** | - | Reducci√≥n de c√≥digo boilerplate |
| **Hibernate Validator** | - | Validaci√≥n de datos |
| **SpringDoc OpenAPI** | 2.8.9 | Documentaci√≥n de API |

## üèóÔ∏è Arquitectura

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Controllers   ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ     Services    ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ   Repositories ‚îÇ
‚îÇ   (REST API)    ‚îÇ    ‚îÇ   (Business)    ‚îÇ    ‚îÇ   (Data Access) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      DTOs       ‚îÇ    ‚îÇ    Entities    ‚îÇ    ‚îÇ   PostgreSQL    ‚îÇ
‚îÇ  (Data Transfer)‚îÇ    ‚îÇ   (JPA Models) ‚îÇ    ‚îÇ   (Database)    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚îÇ                       ‚îÇ                       ‚îÇ
         ‚ñº                       ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Email Service ‚îÇ    ‚îÇ    OTP Service  ‚îÇ    ‚îÇ   Gmail SMTP    ‚îÇ
‚îÇ   (Notifications)‚îÇ    ‚îÇ   (Security)   ‚îÇ    ‚îÇ   (Email)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üì¶ M√≥dulos Implementados

### 1. üîê Autenticaci√≥n y Usuarios
- **Registro tradicional** con validaci√≥n de email
- **Registro UCV** con validaci√≥n de username y OTP por email
- **Login con JWT** y gesti√≥n de tokens
- **Perfil de usuario** con roles (CLIENTE, ADMIN)
- **Seguridad** con Spring Security 6
- **Env√≠o de emails** con c√≥digos OTP de verificaci√≥n

### 2. üè™ Gesti√≥n de Tiendas
- **Listado de tiendas** (Listo, Fresco, Emprendedores)
- **B√∫squeda por tipo** (MINIMARKET, DULCERIA, EMPRENDEDOR)
- **Gesti√≥n de estado** activo/inactivo
- **Informaci√≥n detallada** de cada tienda

### 3. üõçÔ∏è Cat√°logo de Productos
- **Listado de productos** por tienda
- **B√∫squeda avanzada** por nombre y descripci√≥n
- **Gesti√≥n de stock** y precios
- **Im√°genes de productos** (URLs)
- **Filtros por tienda** y estado

### 4. üõí Carrito de Compras
- **Agregar/quitar productos** del carrito
- **Actualizar cantidades** con validaci√≥n de stock
- **C√°lculo autom√°tico** de totales y subtotales
- **Persistencia** del carrito por usuario
- **Validaci√≥n de stock** antes de agregar

### 5. üì¶ Gesti√≥n de Pedidos
- **Crear pedidos** desde el carrito
- **Selecci√≥n de lugar de entrega** (pabell√≥n, piso, sal√≥n)
- **Estados de pedido**: PENDIENTE, PREPARANDO, EN_CAMINO, ENTREGADO, CANCELADO
- **Historial de pedidos** del cliente
- **Actualizaci√≥n autom√°tica** de stock
- **Notas del pedido** opcionales

## üéì Sistema de Autenticaci√≥n UCV

### Caracter√≠sticas del Sistema UCV

El sistema est√° dise√±ado espec√≠ficamente para estudiantes de la Universidad C√©sar Vallejo con las siguientes caracter√≠sticas:

#### **Validaci√≥n de Username UCV**
- **Formato**: Solo letras may√∫sculas y n√∫meros (ej: `XMONTANOGA`)
- **Longitud**: Entre 3 y 20 caracteres
- **Patr√≥n**: `^[A-Z0-9]+$`

#### **Validaci√≥n de Contrase√±a Segura**
- **Longitud m√≠nima**: 8 caracteres
- **Requisitos obligatorios**:
  - Al menos una letra min√∫scula
  - Al menos una letra may√∫scula
  - Al menos un n√∫mero
  - Al menos un s√≠mbolo (@$!%*?&)
- **Patr√≥n**: `^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[@$!%*?&])[A-Za-z\\d@$!%*?&]{8,}$`

#### **Generaci√≥n Autom√°tica de Email UCV**
- **Formato**: `{username}@ucvvirtual.edu.pe`
- **Ejemplo**: `XMONTANOGA@ucvvirtual.edu.pe`

#### **Sistema de Verificaci√≥n OTP**
- **C√≥digo**: 6 d√≠gitos num√©ricos
- **Expiraci√≥n**: 10 minutos
- **Env√≠o**: Por email autom√°tico
- **Seguridad**: C√≥digos √∫nicos por sesi√≥n

### Flujo de Registro UCV

```mermaid
graph TD
    A[Estudiante ingresa username y contrase√±a] --> B[Validar formato de username]
    B --> C[Validar contrase√±a segura]
    C --> D[Generar email UCV autom√°ticamente]
    D --> E[Verificar que username no exista]
    E --> F[Generar c√≥digo OTP de 6 d√≠gitos]
    F --> G[Enviar OTP por email]
    G --> H[Estudiante ingresa c√≥digo OTP]
    H --> I[Verificar OTP v√°lido y no expirado]
    I --> J[Crear usuario en base de datos]
    J --> K[Generar JWT y retornar token]
```

## ‚öôÔ∏è Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

- **Java 21+** (OpenJDK o Oracle JDK)
- **Maven 3.6+**
- **PostgreSQL 12+**
- **Gmail Account** (para env√≠o de emails)
- **IntelliJ IDEA** (recomendado) o Eclipse
- **Git** (para clonar el repositorio)

### 1. Configuraci√≥n de la Base de Datos

#### Crear Base de Datos en PostgreSQL:

```sql
-- Conectar a PostgreSQL como superusuario
psql -U postgres

-- Crear la base de datos
CREATE DATABASE foodv_db
    WITH 
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'Spanish_Spain.1252'
    LC_CTYPE = 'Spanish_Spain.1252'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1;

-- Crear usuario espec√≠fico (opcional)
CREATE USER foodv_user WITH PASSWORD 'foodv_password';
GRANT ALL PRIVILEGES ON DATABASE foodv_db TO foodv_user;
GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO foodv_user;
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO foodv_user;
```

### 2. Configuraci√≥n de Email (Gmail)

#### Configurar Contrase√±a de Aplicaci√≥n:

1. **Habilitar autenticaci√≥n de 2 factores** en tu cuenta de Gmail
2. **Generar contrase√±a de aplicaci√≥n**:
   - Ve a: https://myaccount.google.com/
   - Seguridad ‚Üí Verificaci√≥n en 2 pasos
   - Contrase√±as de aplicaciones
   - Genera una nueva contrase√±a para "Mail"
   - **Guarda esta contrase√±a de 16 caracteres**

#### Configurar Variables de Entorno:

```bash
# Windows (PowerShell)
$env:MAIL_USERNAME="tu-email@gmail.com"
$env:MAIL_PASSWORD="tu-contrase√±a-de-aplicaci√≥n"

# Windows (CMD)
set MAIL_USERNAME=tu-email@gmail.com
set MAIL_PASSWORD=tu-contrase√±a-de-aplicaci√≥n

# Linux/Mac
export MAIL_USERNAME="tu-email@gmail.com"
export MAIL_PASSWORD="tu-contrase√±a-de-aplicaci√≥n"
```

### 3. Configuraci√≥n del Proyecto

#### Clonar e Importar en IntelliJ:

```bash
# Clonar el repositorio (si est√° en Git)
git clone <repository-url>
cd foodv

# O simplemente abrir la carpeta del proyecto en IntelliJ
```

#### Configurar en IntelliJ IDEA:

1. **Importar el proyecto**:
   - File ‚Üí Open ‚Üí Seleccionar la carpeta del proyecto
   - Seleccionar "Import project from external model" ‚Üí Maven
   - Click "Next" ‚Üí "Finish"

2. **Configurar JDK**:
   - File ‚Üí Project Structure ‚Üí Project ‚Üí Project SDK ‚Üí Java 21
   - Verificar que Maven est√© configurado correctamente

3. **Configurar Base de Datos**:
   - Verificar que PostgreSQL est√© ejecut√°ndose
   - La configuraci√≥n de conexi√≥n est√° en `src/main/resources/application.properties`

### 4. Configuraci√≥n de application.properties

Verificar que el archivo `src/main/resources/application.properties` tenga la configuraci√≥n correcta:

```properties
# Database Configuration
spring.datasource.url=jdbc:postgresql://localhost:5432/foodv_db
spring.datasource.username=postgres
spring.datasource.password=tu_password_de_postgres
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA Configuration
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true

# JWT Configuration
jwt.secret=mySecretKey123456789012345678901234567890
jwt.expiration=86400000

# Email Configuration
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${MAIL_USERNAME:tu-email@gmail.com}
spring.mail.password=${MAIL_PASSWORD:tu-contrase√±a-de-aplicaci√≥n}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com
spring.mail.properties.mail.smtp.ssl.protocols=TLSv1.2

# App Configuration
app.mail.from=noreply@foodv.ucv.edu.pe

# Server Configuration
server.port=8080

# Logging
logging.level.pe.ucv.foodv=DEBUG
logging.level.org.springframework.security=DEBUG
```

### 5. Ejecutar el Proyecto

#### Desde IntelliJ IDEA:
1. **Ejecutar la aplicaci√≥n**:
   - Click derecho en `FoodVApplication.java`
   - Seleccionar "Run 'FoodVApplication'"
   - O usar el bot√≥n ‚ñ∂Ô∏è verde en la barra de herramientas

#### Desde Terminal:
```bash
# Compilar y ejecutar
mvn clean install
mvn spring-boot:run

# O compilar JAR y ejecutar
mvn clean package
java -jar target/foodv-0.0.1-SNAPSHOT.jar
```

#### Verificaci√≥n de Ejecuci√≥n:

Deber√≠as ver en la consola:
```
Started FoodVApplication in X.XXX seconds (JVM running for X.XXX)
Usuarios creados exitosamente
Tiendas creadas exitosamente
Productos creados exitosamente
```

## üîó API Endpoints

### üîê Autenticaci√≥n (P√∫blicos)

| M√©todo | Endpoint | Descripci√≥n | Request Body |
|--------|----------|-------------|--------------|
| `POST` | `/api/auth/register` | Registro tradicional | `{"name": "string", "email": "string", "password": "string"}` |
| `POST` | `/api/auth/login` | Login tradicional | `{"email": "string", "password": "string"}` |
| `POST` | `/api/auth/register-ucv` | **Registro UCV** | `{"username": "string", "password": "string"}` |
| `POST` | `/api/auth/verify-otp` | **Verificar OTP UCV** | `{"username": "string", "otpCode": "string"}` |
| `POST` | `/api/auth/login-username` | **Login con username** | `{"usernameOrEmail": "string", "password": "string"}` |

### üë§ Usuarios (Protegidos)

| M√©todo | Endpoint | Descripci√≥n | Headers |
|--------|----------|-------------|---------|
| `GET` | `/api/users/profile` | Obtener perfil del usuario | `Authorization: Bearer {token}` |

### üè™ Tiendas (P√∫blicos)

| M√©todo | Endpoint | Descripci√≥n | Par√°metros |
|--------|----------|-------------|------------|
| `GET` | `/api/stores` | Listar todas las tiendas | - |
| `GET` | `/api/stores/{id}` | Obtener tienda por ID | `id` (Long) |
| `GET` | `/api/stores/type/{type}` | Listar tiendas por tipo | `type` (MINIMARKET, DULCERIA, EMPRENDEDOR) |

### üõçÔ∏è Productos (P√∫blicos)

| M√©todo | Endpoint | Descripci√≥n | Par√°metros |
|--------|----------|-------------|------------|
| `GET` | `/api/products` | Listar todos los productos | - |
| `GET` | `/api/products/{id}` | Obtener producto por ID | `id` (Long) |
| `GET` | `/api/products/store/{storeId}` | Listar productos de una tienda | `storeId` (Long) |
| `GET` | `/api/products/search` | Buscar productos | `q` (String) |
| `GET` | `/api/products/store/{storeId}/search` | Buscar productos en una tienda | `storeId` (Long), `q` (String) |

### üõí Carrito (Protegidos)

| M√©todo | Endpoint | Descripci√≥n | Headers | Request Body |
|--------|----------|-------------|---------|--------------|
| `GET` | `/api/cart` | Obtener carrito del usuario | `Authorization: Bearer {token}` | - |
| `POST` | `/api/cart/add` | Agregar producto al carrito | `Authorization: Bearer {token}` | `{"productId": Long, "quantity": Integer}` |
| `PUT` | `/api/cart/items/{itemId}` | Actualizar cantidad de item | `Authorization: Bearer {token}` | `{"quantity": Integer}` |
| `DELETE` | `/api/cart/items/{itemId}` | Eliminar item del carrito | `Authorization: Bearer {token}` | - |
| `DELETE` | `/api/cart/clear` | Vaciar carrito | `Authorization: Bearer {token}` | - |

### üì¶ Pedidos (Protegidos)

| M√©todo | Endpoint | Descripci√≥n | Headers | Request Body |
|--------|----------|-------------|---------|--------------|
| `POST` | `/api/orders` | Crear pedido | `Authorization: Bearer {token}` | `{"pabellon": "string", "piso": "string", "salon": "string", "notes": "string"}` |
| `GET` | `/api/orders` | Listar pedidos del usuario | `Authorization: Bearer {token}` | - |
| `GET` | `/api/orders/{orderId}` | Obtener pedido por ID | `Authorization: Bearer {token}` | - |
| `GET` | `/api/orders/status/{status}` | Listar pedidos por estado | `Authorization: Bearer {token}` | - |

## üß™ Datos de Prueba

El sistema incluye datos de prueba que se cargan autom√°ticamente al iniciar la aplicaci√≥n:

### üë• Usuarios de Prueba

| Email | Contrase√±a | Rol | Descripci√≥n |
|-------|------------|-----|-------------|
| `admin@ucv.edu.pe` | `admin123` | ADMIN | Administrador del sistema |
| `juan.perez@ucv.edu.pe` | `password123` | CLIENTE | Usuario de prueba 1 |
| `maria.garcia@ucv.edu.pe` | `password123` | CLIENTE | Usuario de prueba 2 |

### üè™ Tiendas de Prueba

| Nombre | Tipo | Descripci√≥n | Productos |
|--------|------|-------------|-----------|
| **Listo** | MINIMARKET | Productos b√°sicos para estudiantes | Agua, Gaseosa, Galletas, Chicle, Caf√© |
| **Fresco** | DULCERIA | Snacks y golosinas | Chocolate, Caramelos, Gomitas, Helado |
| **Caf√© del Estudiante** | EMPRENDEDOR | Caf√© y snacks preparados | Caf√© Americano, Caf√© con Leche, Sandwich, Empanada |
| **Snacks Saludables** | EMPRENDEDOR | Productos org√°nicos y saludables | Ensalada de Frutas, Yogurt, Barra Energ√©tica, Jugo Natural |

## üìÆ Pruebas con Postman

### Configuraci√≥n de Postman

1. **Crear nueva colecci√≥n**: "FoodV API"
2. **Configurar variables de entorno**:
   - `base_url`: `http://localhost:8080`
   - `token`: (se llenar√° autom√°ticamente despu√©s del login)

### Secuencia de Pruebas Recomendada

#### 1. üéì Registro UCV (Nuevo)

```http
POST {{base_url}}/api/auth/register-ucv
Content-Type: application/json

{
    "username": "XMONTANOGA",
    "password": "MiPassword123!"
}
```

**Respuesta esperada:**
```json
{
    "success": true,
    "message": "Proceso iniciado",
    "data": "C√≥digo de verificaci√≥n enviado a XMONTANOGA@ucvvirtual.edu.pe"
}
```

#### 2. üìß Verificar OTP

```http
POST {{base_url}}/api/auth/verify-otp
Content-Type: application/json

{
    "username": "XMONTANOGA",
    "otpCode": "123456"
}
```

**Respuesta esperada:**
```json
{
    "success": true,
    "message": "Registro completado exitosamente",
    "data": {
        "token": "eyJhbGciOiJIUzI1NiJ9...",
        "type": "Bearer",
        "id": 5,
        "name": "XMONTANOGA",
        "email": "XMONTANOGA@ucvvirtual.edu.pe",
        "role": "CLIENTE"
    }
}
```

#### 3. üîë Login con Username

```http
POST {{base_url}}/api/auth/login-username
Content-Type: application/json

{
    "usernameOrEmail": "XMONTANOGA",
    "password": "MiPassword123!"
}
```

#### 4. üîë Login con Email UCV

```http
POST {{base_url}}/api/auth/login-username
Content-Type: application/json

{
    "usernameOrEmail": "XMONTANOGA@ucvvirtual.edu.pe",
    "password": "MiPassword123!"
}
```

#### 5. üîê Login Tradicional

```http
POST {{base_url}}/api/auth/login
Content-Type: application/json

{
    "email": "test@ucv.edu.pe",
    "password": "password123"
}
```

**‚ö†Ô∏è IMPORTANTE**: Copia el `token` de la respuesta y gu√°rdalo en la variable `{{token}}` para los siguientes requests.

#### 6. üè™ Listar Tiendas

```http
GET {{base_url}}/api/stores
```

#### 7. üõçÔ∏è Listar Productos

```http
GET {{base_url}}/api/products
```

#### 8. üîç Buscar Productos

```http
GET {{base_url}}/api/products/search?q=agua
```

#### 9. üë§ Obtener Perfil

```http
GET {{base_url}}/api/users/profile
Authorization: Bearer {{token}}
```

#### 10. üõí Agregar al Carrito

```http
POST {{base_url}}/api/cart/add
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "productId": 1,
    "quantity": 2
}
```

#### 11. üõí Ver Carrito

```http
GET {{base_url}}/api/cart
Authorization: Bearer {{token}}
```

#### 12. üì¶ Crear Pedido

```http
POST {{base_url}}/api/orders
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "pabellon": "A",
    "piso": "2",
    "salon": "201",
    "notes": "Entregar en la puerta del sal√≥n"
}
```

#### 13. üìã Ver Historial de Pedidos

```http
GET {{base_url}}/api/orders
Authorization: Bearer {{token}}
```

## üìÅ Estructura del Proyecto

```
src/main/java/pe/ucv/foodv/
‚îú‚îÄ‚îÄ üìÅ config/                    # Configuraci√≥n del sistema
‚îÇ   ‚îú‚îÄ‚îÄ SecurityConfig.java      # Configuraci√≥n de Spring Security
‚îÇ   ‚îú‚îÄ‚îÄ DataSeeder.java          # Datos de prueba (seeds)
‚îÇ   ‚îî‚îÄ‚îÄ EmailConfig.java          # Configuraci√≥n de email
‚îú‚îÄ‚îÄ üìÅ controller/               # Controladores REST
‚îÇ   ‚îú‚îÄ‚îÄ AuthController.java     # Autenticaci√≥n (login/register)
‚îÇ   ‚îú‚îÄ‚îÄ UserController.java     # Gesti√≥n de usuarios
‚îÇ   ‚îú‚îÄ‚îÄ StoreController.java    # Gesti√≥n de tiendas
‚îÇ   ‚îú‚îÄ‚îÄ ProductController.java  # Gesti√≥n de productos
‚îÇ   ‚îú‚îÄ‚îÄ CartController.java     # Gesti√≥n del carrito
‚îÇ   ‚îú‚îÄ‚îÄ OrderController.java    # Gesti√≥n de pedidos
‚îÇ   ‚îî‚îÄ‚îÄ DebugController.java    # Endpoints de debug
‚îú‚îÄ‚îÄ üìÅ dto/                      # DTOs para transferencia de datos
‚îÇ   ‚îú‚îÄ‚îÄ AuthResponse.java       # Respuesta de autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ LoginRequest.java       # Request de login tradicional
‚îÇ   ‚îú‚îÄ‚îÄ LoginUsernameRequest.java # Request de login con username
‚îÇ   ‚îú‚îÄ‚îÄ RegisterRequest.java    # Request de registro tradicional
‚îÇ   ‚îú‚îÄ‚îÄ RegisterUcvRequest.java # Request de registro UCV
‚îÇ   ‚îú‚îÄ‚îÄ VerifyOtpRequest.java   # Request de verificaci√≥n OTP
‚îÇ   ‚îú‚îÄ‚îÄ UserResponse.java       # Respuesta de usuario
‚îÇ   ‚îú‚îÄ‚îÄ StoreResponse.java      # Respuesta de tienda
‚îÇ   ‚îú‚îÄ‚îÄ ProductResponse.java    # Respuesta de producto
‚îÇ   ‚îú‚îÄ‚îÄ CartResponse.java       # Respuesta de carrito
‚îÇ   ‚îú‚îÄ‚îÄ OrderResponse.java      # Respuesta de pedido
‚îÇ   ‚îî‚îÄ‚îÄ ApiResponse.java        # Respuesta gen√©rica de API
‚îú‚îÄ‚îÄ üìÅ exception/               # Manejo de excepciones
‚îÇ   ‚îî‚îÄ‚îÄ GlobalExceptionHandler.java # Handler global de excepciones
‚îú‚îÄ‚îÄ üìÅ model/entity/            # Entidades JPA
‚îÇ   ‚îú‚îÄ‚îÄ User.java              # Entidad Usuario (con username UCV)
‚îÇ   ‚îú‚îÄ‚îÄ Store.java             # Entidad Tienda
‚îÇ   ‚îú‚îÄ‚îÄ Product.java           # Entidad Producto
‚îÇ   ‚îú‚îÄ‚îÄ Cart.java              # Entidad Carrito
‚îÇ   ‚îú‚îÄ‚îÄ CartItem.java          # Entidad Item del Carrito
‚îÇ   ‚îú‚îÄ‚îÄ Order.java             # Entidad Pedido
‚îÇ   ‚îî‚îÄ‚îÄ OrderItem.java         # Entidad Item del Pedido
‚îú‚îÄ‚îÄ üìÅ repository/              # Repositorios JPA
‚îÇ   ‚îú‚îÄ‚îÄ UserRepository.java    # Repositorio de Usuarios
‚îÇ   ‚îú‚îÄ‚îÄ StoreRepository.java   # Repositorio de Tiendas
‚îÇ   ‚îú‚îÄ‚îÄ ProductRepository.java # Repositorio de Productos
‚îÇ   ‚îú‚îÄ‚îÄ CartRepository.java    # Repositorio de Carritos
‚îÇ   ‚îú‚îÄ‚îÄ CartItemRepository.java # Repositorio de Items del Carrito
‚îÇ   ‚îú‚îÄ‚îÄ OrderRepository.java   # Repositorio de Pedidos
‚îÇ   ‚îî‚îÄ‚îÄ OrderItemRepository.java # Repositorio de Items del Pedido
‚îú‚îÄ‚îÄ üìÅ security/                # Configuraci√≥n de seguridad
‚îÇ   ‚îú‚îÄ‚îÄ JwtUtil.java           # Utilidades JWT
‚îÇ   ‚îú‚îÄ‚îÄ JwtAuthenticationFilter.java # Filtro de autenticaci√≥n JWT
‚îÇ   ‚îî‚îÄ‚îÄ UserDetailsServiceImpl.java # Implementaci√≥n de UserDetailsService
‚îú‚îÄ‚îÄ üìÅ service/                 # Servicios de negocio
‚îÇ   ‚îú‚îÄ‚îÄ AuthService.java       # Servicio de autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ EmailService.java      # Servicio de env√≠o de emails
‚îÇ   ‚îú‚îÄ‚îÄ OtpService.java        # Servicio de c√≥digos OTP
‚îÇ   ‚îú‚îÄ‚îÄ StoreService.java      # Servicio de tiendas
‚îÇ   ‚îú‚îÄ‚îÄ ProductService.java    # Servicio de productos
‚îÇ   ‚îú‚îÄ‚îÄ CartService.java       # Servicio del carrito
‚îÇ   ‚îî‚îÄ‚îÄ OrderService.java      # Servicio de pedidos
‚îî‚îÄ‚îÄ FoodVApplication.java      # Clase principal de Spring Boot
```

## üöÄ Configuraci√≥n de Producci√≥n

Para desplegar en producci√≥n, actualizar las siguientes propiedades en `application.properties`:

```properties
# Base de datos de producci√≥n
spring.datasource.url=jdbc:postgresql://tu-servidor:5432/foodv_db
spring.datasource.username=tu-usuario
spring.datasource.password=tu-password-segura

# JWT secreto m√°s seguro (m√≠nimo 256 bits)
jwt.secret=tu-clave-secreta-muy-larga-y-segura-de-al-menos-32-caracteres
jwt.expiration=86400000

# Configuraci√≥n de email de producci√≥n
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com

# Configuraci√≥n de servidor
server.port=8080
server.servlet.context-path=/api

# Logging de producci√≥n
logging.level.pe.ucv.foodv=INFO
logging.level.org.springframework.security=WARN
logging.level.org.springframework.web=WARN
logging.level.org.hibernate.SQL=WARN

# Configuraci√≥n de CORS para producci√≥n
spring.web.cors.allowed-origins=https://tu-dominio.com
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
```

### Variables de Entorno Recomendadas

```bash
# Base de datos
DB_URL=jdbc:postgresql://localhost:5432/foodv_db
DB_USERNAME=postgres
DB_PASSWORD=tu_password_segura

# JWT
JWT_SECRET=tu_clave_secreta_muy_larga_y_segura
JWT_EXPIRATION=86400000

# Email
MAIL_USERNAME=tu-email@gmail.com
MAIL_PASSWORD=tu-contrase√±a-de-aplicaci√≥n

# Servidor
SERVER_PORT=8080
```

## üêõ Soluci√≥n de Problemas

### Error de Conexi√≥n a Base de Datos
```
org.postgresql.util.PSQLException: FATAL: password authentication failed
```
**Soluci√≥n**: 
- Verificar que PostgreSQL est√© ejecut√°ndose
- Verificar credenciales en `application.properties`
- Verificar que la base de datos `foodv_db` exista

### Error de Autenticaci√≥n de Email
```
Authentication failed
```
**Soluci√≥n**: 
- Verificar que las variables de entorno `MAIL_USERNAME` y `MAIL_PASSWORD` est√©n configuradas
- Verificar que la contrase√±a de aplicaci√≥n de Gmail sea correcta (16 caracteres sin espacios)
- Verificar que la autenticaci√≥n de 2 factores est√© habilitada en Gmail

### Error de Validaci√≥n de Username UCV
```
El nombre de usuario debe contener solo letras may√∫sculas y n√∫meros
```
**Soluci√≥n**: 
- Usar solo letras may√∫sculas y n√∫meros (ej: `XMONTANOGA`)
- No usar caracteres especiales o espacios
- Longitud entre 3 y 20 caracteres

### Error de Validaci√≥n de Contrase√±a
```
La contrase√±a debe contener al menos: 8 caracteres, una letra min√∫scula, una may√∫scula, un n√∫mero y un s√≠mbolo
```
**Soluci√≥n**: 
- M√≠nimo 8 caracteres
- Incluir al menos: una min√∫scula, una may√∫scula, un n√∫mero y un s√≠mbolo (@$!%*?&)
- Ejemplo v√°lido: `MiPassword123!`

### Error de OTP Expirado
```
C√≥digo OTP inv√°lido o expirado
```
**Soluci√≥n**: 
- El c√≥digo OTP expira en 10 minutos
- Solicitar un nuevo c√≥digo con `/api/auth/register-ucv`
- Verificar que el c√≥digo sea exactamente de 6 d√≠gitos

### Error 401 Unauthorized
```
{"success":false,"message":"Acceso denegado"}
```
**Soluci√≥n**: 
- Verificar que el token JWT sea v√°lido
- Verificar que el header `Authorization: Bearer {token}` est√© presente
- Verificar que el token no haya expirado
- Hacer login nuevamente para obtener un token fresco

### Error 500 Internal Server Error
```
{"success":false,"message":"Error interno del servidor"}
```
**Soluci√≥n**: 
- Verificar logs en la consola de IntelliJ para m√°s detalles
- Verificar que la base de datos est√© accesible
- Verificar que todas las dependencias est√©n instaladas
- Verificar configuraci√≥n de email

### Error de Puerto en Uso
```
Port 8080 was already in use
```
**Soluci√≥n**: 
- Cambiar el puerto en `application.properties`: `server.port=8081`
- O matar el proceso que usa el puerto 8080

## üìä M√©tricas y Monitoreo

### Endpoints de Debug

- `GET /api/debug/otp-status` - Estado de los c√≥digos OTP almacenados

### Logging Recomendado
```properties
# Logging detallado para desarrollo
logging.level.pe.ucv.foodv=DEBUG
logging.level.org.springframework.security=DEBUG
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# Logging para producci√≥n
logging.level.pe.ucv.foodv=INFO
logging.level.org.springframework.security=WARN
logging.level.org.hibernate.SQL=WARN
```

## ü§ù Contribuci√≥n

### C√≥mo Contribuir
1. Fork el proyecto
2. Crear una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. Commit tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. Push a la rama (`git push origin feature/AmazingFeature`)
5. Abrir un Pull Request

### Est√°ndares de C√≥digo
- Seguir las convenciones de Java
- Documentar m√©todos p√∫blicos
- Escribir tests unitarios
- Usar nombres descriptivos para variables y m√©todos

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT. Ver el archivo `LICENSE` para m√°s detalles.

## üë• Equipo de Desarrollo

- **Desarrollador Principal**: [Tu Nombre]
- **Universidad**: Universidad C√©sar Vallejo
- **Proyecto**: FoodV - Sistema de Delivery

## üìû Contacto

Para soporte t√©cnico o consultas sobre el proyecto:

- **Email**: [tu-email@ucv.edu.pe]
- **GitHub**: [tu-usuario-github]
- **Universidad**: Universidad C√©sar Vallejo

---

## üéØ Roadmap Futuro

### Pr√≥ximas Caracter√≠sticas
- [ ] **Notificaciones Push**: Integraci√≥n con Firebase Cloud Messaging
- [ ] **Pagos**: Integraci√≥n con pasarelas de pago
- [ ] **Geolocalizaci√≥n**: Tracking de pedidos en tiempo real
- [ ] **Chat**: Sistema de mensajer√≠a entre cliente y tienda
- [ ] **Reviews**: Sistema de calificaciones y comentarios
- [ ] **Promociones**: Sistema de cupones y descuentos
- [ ] **Analytics**: Dashboard de m√©tricas y reportes
- [ ] **Multi-idioma**: Soporte para m√∫ltiples idiomas

### Mejoras T√©cnicas
- [ ] **Redis**: Cache para mejorar rendimiento
- [ ] **RabbitMQ**: Cola de mensajes para notificaciones
- [ ] **Docker**: Containerizaci√≥n de la aplicaci√≥n
- [ ] **Kubernetes**: Orquestaci√≥n de contenedores
- [ ] **CI/CD**: Pipeline de integraci√≥n continua
- [ ] **Tests**: Cobertura de tests del 90%+
- [ ] **Documentaci√≥n**: API documentation con Swagger/OpenAPI

---

**¬°Gracias por usar FoodV! üçî‚ú®**